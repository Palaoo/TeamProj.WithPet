<!DOCTYPE html>
<html lang="en">
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>SHOP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <th:block th:replace="fragments/index::style"></th:block>
</head>
<style>
    form{
        display:inline;
    }
    .nav-link:hover,.nav-link:focus{
        color: #000 !important;
    }
    .div1 {
        width: 95%;
        height: 600px;
        margin: auto;
    }

    .div-imgcontainer {
        width: 50vh;
        height: 50vw;
        float: left;
    }

    .div-right {
        width: 50%;
        height: 95%;
        float: right;
    }

    .rating {
        -webkit-text-fill-color: gold;
    }

    #quantity{
        width:100%;
        border:0;
        outline:0;
        text-align:right;
        /*height: 100%;*/
        padding-top: 10px;
    }
    #totalPrice{
        padding-top: 10px;
    }
    .breadcrumb-option{
        margin-bottom: 10%;
    }
    #totalPrice{
        margin-top: 10px;
        margin-bottom: 10px;
    }
    #total_dv{
        padding-top: 30px;
        padding-bottom: 30px;
    }
    #tabs-6{
        margin-bottom: 10%;
    }
</style>
<body>
<div th:replace="fragments/index :: header"></div>

<section class="breadcrumb-option">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="breadcrumb__text">
                    <h4>Shop</h4>
                    <div class="breadcrumb__links">
                        <a href="/">Home</a>
                        <a href="/mallPage">Shop</a>
                        <span>Product Details</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="shop-details">
    <!--<div class="product__details__pic">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="product__details__breadcrumb">
                        <a href="/">Home</a>
                        <a href="/mallPage">Shop</a>
                        <span>Product Details</span>
                    </div>
                </div>
            </div>
        </div>
    </div>-->
    <div class="product__details__content">
        <div class="container">
            <div class="row d-flex justify-content-center">
                <div class="col-12 col-lg-6" align="right">
                    <!--<ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" data-toggle="tab" href="#tabs-1" role="tab">
                                <div class="product__thumb__pic set-bg">

                                </div>
                            </a>
                        </li>
                    </ul>-->
                    <img th:src="${img}" id="prod_img" width="300" height="300">
                </div>
                <div class="col-12 col-lg-6">
                    <div class="product__details__text">
                        <p th:text="${product.name}">상품명</p>
                        <div class="rating">
                           <!-- <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star-o"></i>-->
                            <span th:text="|${pReviewList.size()}Reviews|"> - 5 Reviews</span>
                        </div>
                        <h3 th:text="${product.price}" id="price"></h3> <!--<span>70.00</span>-->
                        <input type="hidden" name="prodId" id="prodId" th:value="${product.id}">
                        <!--<p>Coat with quilted lining and an adjustable hood. Featuring long sleeves with adjustable
                            cuff tabs, adjustable asymmetric hem with elastic side tabs and a front zip fastening
                            with placket.</p>-->
                        <div class="product__details__cart__option">
                            <div class="quantity" align="center">
                                <div class="pro-qty-2">
                                    <!--                                    <table>-->
                                    <!--                                        <tr>-->
                                    <!--                                            <td>-->
                                    <!--                                                <input id="quantity" name="quantity_name" style="" value="1" type="text"/>-->
                                    <!--                                            </td>-->
                                    <!--                                            <td>-->
                                    <!--                                                <button-->
                                    <!--                                                        id="btnQuantityUp"><img-->
                                    <!--                                                        src="//img.echosting.cafe24.com/skin/base_ko_KR/product/btn_count_up.gif"-->
                                    <!--                                                        alt="수량증가"-->
                                    <!--                                                        class="QuantityUp up"/></button>-->
                                    <!--                                            </td>-->
                                    <!--                                            <td>-->

                                    <!--                                            </td>-->
                                    <!--                                        </tr>-->
                                    <!--                                    </table>-->
                                    <!--    <div align="center" style="float:left; margin-right:10px; border:none;">
                                            <input id="quantity" name="quantity_name" style="" value="1" type="text"/>
                                        </div>
                                        <div align="center" style="float:left;">
                                            <div>
                                                <button
                                                        id="btnQuantityUp"><img
                                                        src="//img.echosting.cafe24.com/skin/base_ko_KR/product/btn_count_up.gif"
                                                        width="22" height="13"
                                                        alt="수량증가"
                                                        class="QuantityUp up"/></button>
                                            </div>
                                            <div>
                                                <button id="btnQuantityDown"><img
                                                        src="//img.echosting.cafe24.com/skin/base_ko_KR/product/btn_count_down.gif"
                                                        width="22" height="13"
                                                        alt="수량감소" class="fa fa-angle-left dec qtybtn"/></button>
                                            </div>

                                        </div>-->
                                    <div class="row">
                                        <div align="right" class="col-6">
                                            <input id="quantity" name="quantity_name" style="" value="1" type="text"/>
                                        </div>
                                        <div class="col-6">
                                            <div id="up" align="left">
                                            <span
                                                    id="btnQuantityUp"><img
                                                    src="//img.echosting.cafe24.com/skin/base_ko_KR/product/btn_count_up.gif"
                                                    width="22" height="13"
                                                    alt="수량증가"
                                                    class="QuantityUp up"/></span>
                                            </div>

                                            <div id="down" align="left">
                                            <span id="btnQuantityDown"><img
                                                    src="//img.echosting.cafe24.com/skin/base_ko_KR/product/btn_count_down.gif"
                                                    width="22" height="13"
                                                    alt="수량감소" class="fa fa-angle-left dec qtybtn"/></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="total_dv">
                                <h5>총액: <span class="quantity_price" id="totalPrice"
                                              th:text="| ${product.price}|">19800</span></h5>

                            </div>
                            <div>
                                <a href="#" class="primary-btn" id="payment">TossPay 결제</a>
                                <a href="#" class="primary-btn" id="bascket">장바구니</a>
                            </div>
                        </div>

                        <!--<div class="product__details__btns__option">
                            <a href="#"><i class="fa fa-heart"></i> add to wishlist</a>
                            <a href="#"><i class="fa fa-exchange"></i> Add To Compare</a>
                        </div>-->
                    </div>
                </div>
            </div>

            <!--상세설명-->
            <div class="row">
                <div class="col-lg-12">
                    <div class="product__details__tab">
                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" data-toggle="tab" href="#tabs-5"
                                   role="tab">제품설명</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#tabs-6" role="tab"
                                   th:text="|Customer Previews(${pReviewList.size()})|">사용리뷰(0)</a>
                            </li>
                        </ul>

                        <div class="tab-content">
                            <div class="tab-pane active" id="tabs-5" role="tabpanel">
                                <div class="product__details__tab__content">
                                    <p name="" id="" cols="30" rows="10" th:utext="${product.detail}"></p>
                                </div>
                            </div>

<!--                            <ul class="nav nav-tabs" role="tablist">-->
<!--                                <li class="nav-item">-->
<!--                                    <a class="nav-link" data-toggle="tab" href="#tabs-5"-->
<!--                                       role="tab">Description</a>-->
<!--                                </li>-->
<!--                                <li class="nav-item">-->
<!--                                    <a class="nav-link active" data-toggle="tab" href="#tabs-6" role="tab"-->
<!--                                       th:text="|Customer Previews(${pReviewList.size()})|">Customer-->
<!--                                        Previews(5)</a>-->
<!--                                </li>-->
<!--                            </ul>-->

                            <div class="tab-pane" id="tabs-6" role="tabpanel">
                                <div class="product__details__tab__content" th:each="pReview:${pReviewList}">
                                    <div class="product__details__tab__content__item">
                                        <div class="rating" style="float:left;">
                                            <i class="fa fa-star" th:if="${pReview.star>=1}"></i>
                                            <i class="fa fa-star" th:if="${pReview.star>=2}"></i>
                                            <i class="fa fa-star" th:if="${pReview.star>=3}"></i>
                                            <i class="fa fa-star" th:if="${pReview.star>=4}"></i>
                                            <i class="fa fa-star" th:if="${pReview.star>=5}"></i>
                                        </div>

                                        <div style="float:right;">
                                            <h5 align="right" th:text="${pReview.userId}">id</h5>
                                        </div>

                                    </div>
                                    <div th:text="${pReview.text}">
                                    </div>
                                    <div>
                                        <img src="">
                                    </div>
                                    <hr>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<th:block th:replace="fragments/index :: footer"></th:block>
</body>
<script src="https://js.tosspayments.com/v1"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    const triggerTabList = document.querySelectorAll('#myTab a')
    triggerTabList.forEach(triggerEl => {
        const tabTrigger = new bootstrap.Tab(triggerEl)

        triggerEl.addEventListener('click', event => {
            event.preventDefault()
            tabTrigger.show()
        })
    })

    $(document).ready(function () {
        console.log('ready 동작')
        $(".nav-link").click(function () {
            $(this).tab('show');
        });
    });

    $(document).on('click', '#payment', function () {
        tossPayments()
    }).on('click', '#btnQuantityUp', function () {
        $('#quantity').val(parseInt($('#quantity').val()) + 1);
        $('#totalPrice').text(parseInt($('#price').text()) * parseInt($('#quantity').val()))
    }).on('click', '#btnQuantityDown', function () {
    if($('#quantity').val()>1)
        $('#quantity').val(parseInt($('#quantity').val()) - 1);
        $('#totalPrice').text(parseInt($('#price').text()) * parseInt($('#quantity').val()))
    }).on('click', '#bascket', function () {
        $.ajax({
            type: 'get', url: 'append_basket?prodId=' + $('#prodId').val(),
            success: function () {
                alert('장바구니에 추가되었습니다.')
            }
        })
    })


    $('#logo').on('click', function () {
        location = '/';
    })

    function tossPayments() {
        let clientKey = 'test_ck_mnRQoOaPz8L0knPzxY58y47BMw6v'
        let tossPayments = TossPayments(clientKey)
        let totalPrice = parseInt($('#totalPrice').text());
        tossPayments.requestPayment('카드', {
            // 결제 수단 파라미터
            // 결제 정보 파라미터
            amount: totalPrice,
            orderId: 'L6o8LEvy99H1wUTR6vOT3',
            orderName: '토스 티셔츠 외 2건',
            customerName: '박토스',
            successUrl: 'http://localhost:8080/paysuccess'
                + '?priceid=' + $('#prodId').val() + '&count=' + $('#quantity').val(),
            failUrl: 'http://localhost:8080/payfail',
        })
    }

    function handleClick() {
        //I've tried the following, none seem to work
        $('#tabs-5').toggleClass('active');
        $('#tabs-5').show();
        $('#tabs-5').tab('show');
        $('#tabs-6').toggleClass('active');
        $('#tabs-6').show();
        $('#tabs-6').tab('show');
    }




</script>
</html>