<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>/mall proto</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <title>Title</title>
    <th:block th:replace="fragments/index::style"></th:block>
</head>
<style>
#product{margin-bottom:30px;}
#btnLike,#heart_img{text-align:center;}
</style>
<body>
<div th:replace="fragments/index :: header"></div>

<!-- Breadcrumb Section Begin -->
<section class="breadcrumb-option">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="breadcrumb__text">
                    <h4>Shop</h4>
                    <div class="breadcrumb__links">
                        <a href="./index.html">Home</a>
                        <span>Shop</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Breadcrumb Section End -->

<!-- Shop Section Begin -->
<section class="shop spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="shop__product__option">
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <div class="shop__product__option__left">
                                <p>Showing 1–12 of 126 results</p>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <div class="shop__product__option__right">
                                <p>Sort by Price:</p>
                                <select>
                                    <option value="">Low To High</option>
                                    <option value="">$0 - $55</option>
                                    <option value="">$55 - $100</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-4 col-md-6 col-sm-6" th:each="pDTO:${pDTOs}" id="product">
                        <div class="product__item">
                            <div class="product__item__pic set-bg" th:data-setbg="${pDTO.imgURL}" name="btnProd"
                                 th:id="${pDTO.product.id}">
                                <!--th:href="|prod_view?prodId=${pDTO.product.id}|" -->
                                <!-- <img th:src="${pDTO.imgURL}" class="card-img-top" alt="..." height="240px" width="200px"> -->


                                <!--                                    <ul class="product__hover">-->
                                <!--                                        <li>-->

                                <!--                                        </li>-->
                                <!--                                        &lt;!&ndash; <li><a href="#"><img src="img/icon/compare.png" alt=""> <span>Compare</span></a>-->
                                <!--                                </li>-->
                                <!--                                <li><a href="#"><img src="img/icon/search.png" alt=""></a></li> &ndash;&gt;-->
                                <!--                                    </ul>-->
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-9">
                                <h6 th:text="${pDTO.product.name}"></h6>
                                <h5 th:text="|${pDTO.product.price}원|">$67.24</h5>
                                <a href="#" name="addBasket" th:id="${pDTO.product.id}" class="add-cart">
                                    + Add To Cart</a>
                                <!--src="img/icon/add-to-cart.png"-->
                           <!--     <div class="rating">
                                    <i class="fa fa-star-o"></i>
                                    <i class="fa fa-star-o"></i>
                                    <i class="fa fa-star-o"></i>
                                    <i class="fa fa-star-o"></i>
                                    <i class="fa fa-star-o"></i>
                                </div>-->

                            </div>
                            <div class="col-3" id="heart_img">
                                <a href="#" id="btnLike" th:name="${pDTO.product.id}">
                                    <img th:if="${pDTO.isLiked==1}" src="img/icon/redheart.png"
                                         th:id="|btnLike${pDTO.product.id}|" width="38" height="36" alt="">
                                    <img th:if="${pDTO.isLiked==0}" src="img/icon/love.png"
                                         th:id="|btnLike${pDTO.product.id}|" width="38" height="36" alt="">
                                    <p th:text="${pDTO.likeCount}" th:id="|likeCount${pDTO.product.id}|"
                                       name="likeCount" id="cnt"></p>
                                </a>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="product__pagination">
                            <a th:if="${startPage!=1}" th:href="@{/mallPage(page=${startPage}-6,size=9)}">&lt;</a>
                            <a class="active" th:each="num : ${#numbers.sequence(startPage,endPage)}"
                               th:href="@{/mallPage(page=${num}-1,size=9)}" th:text="${num}">1</a>
                            <a th:if="${totalPage>endPage}" th:href="@{/mallPage(page=${endPage},size=9)}">></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Shop Section End -->

<!--origin-->
<!--<div class="row">
<div class="col-lg-4 col-md-6">
<div class="card" style="width: 18rem;" th:each="pDTO:${pDTOs}">
    <img th:src="${pDTO.imgURL}" class="card-img-top" alt="...">
    <div class="card-body">
        <h5 class="card-title" th:text="${pDTO.product.name}"></h5>
        <p class="card-text">jh스토어<br>50000원</p>
        <a href="#" class="btn btn-primary">Go somewhere</a>
    </div>
</div>
</div>
</div>-->

<th:block th:replace="fragments/index :: footer"></th:block>
</body>
<script>
    $(document).on('click', '#btnLike', function () {

        prodId = $(this).attr('name')
        $.ajax({
            type: 'get',
            url: 'append_like?prodId=' + prodId,
            success: function (data) {
                ID = '#btnLike' + prodId
                if (data == '1') {
                    $(ID).attr("src", "img/icon/redheart.png")
                    $(ID).attr("width", "38px")
                    $(ID).attr("height", "36px")
                    $('#likeCount' + prodId).text(parseInt($('#likeCount' + prodId).text()) + 1)
                } else {
                    console.log('여기')
                    $(ID).attr("height", "36px")
                    $(ID).attr("width", "38px")
                    $(ID).attr("src", "img/icon/love.png")
                    $('#likeCount' + prodId).text(parseInt($('#likeCount' + prodId).text()) - 1)
                }
            }
        })
    }).on('click', 'a[name=addBasket]', function () {
        $.ajax({
            type: 'get',
            url: "append_basket?prodId=" + $(this).attr("id"),
            success: function (data) {
                if (data == '1')
                    alert("장바구니에 추가되었습니다.")
                else {
                    alert("장바구니에 이미 추가된 상품입니다.")
                }
            }
        })

    }).on('click', 'div[name=btnProd]', function () {
        let prodId = $(this).attr("id")
        location = "prod_view?prodId=" + prodId
    })
</script>

</html>